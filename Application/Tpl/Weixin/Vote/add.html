<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>微社区系统</title>

<link href="/static/plugin/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/plugin/fontawesome/css/font-awesome.min.css" rel="stylesheet">
<link href="/static/plugin/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<link href="/static/plugin/kindeditor/themes/default/default.css" rel="stylesheet">
<link href="/static/weixin/css/style.css" rel="stylesheet">
<link href="/static/weixin/css/theme.css" rel="stylesheet">
</head>

<body>
<div class="j-fix j-full j-phone-min-pointer">
	<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
    	<tbody>
        	<tr>
            	<td colspan="2" class="j-h72">
<!--头部-->
<include file="Public:zuhheader" />
<!--头部-->
                </td>
            </tr>
            <tr>
                <td class="j-container">
<!--内容-->
<div class="j-full">
    <include file="Public:left" />
    
    <div class="j-centent">
      <div class="j-wrap-1">
      	<div class="j-wrap-2">
        	<div class="j-wrap-3">
			
            	<!--模块-->
                <div class="j-m j-h10"></div>
                <div class="box">
                    <div class="title spacing">
                    	添加投票
                      <div class="j-fr">
                        <a class="j-fz-14" href="javascript:;" onClick="J_refresh()"><span class="icon-refresh"></span> 刷新</a>
                        <a class="j-fz-14" href="javascript:;" onClick="J_goback()"><span class="icon-reply"></span> 返回</a>
                      </div>
                    </div>
                    
                    <div class="j-m j-h1 j-bkcl2"></div>
                    <div class="j-m-spacing">
                    	<div class="j-m j-h10"></div>
                    	<!--表单-->
                    	<form action="" method="post" id="s_form" autocomplete="off" onSubmit="return Validator.Validate(this,4)">
                        <div class="j-m j-h1"></div>
                        <table border="0" width="100%" cellpadding="0" cellspacing="0">
                        	<tbody>
                            	<tr>
                                    <td class="j-formbk">
                                    	<div class="j-m">
                                        <table border="0" width="100%" cellpadding="0" cellspacing="0" class="j-table j-table-sortline-dashed j-table-vertival-mid">
                                          <tbody>
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="input-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">标题</td>
                                                        <td>
                                                          <input type="text" name="title" value="{$detail.title}" datatype="Require" msg="请输入标题">
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">投票封面</td>
                                                        <td>
                                                          <input type="hidden" name="uploadcover" value="{$detail.picurl|default='/Public/images/default02/sqtp.jpg'}">
                                                          <img class="j-w-90" src="{$detail.picurl|default='/Public/images/default02/sqtp.jpg'}">
                                                          <a id="uploadcover" class="btn">上传图片</a>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">显示封面</td>
                                                        <td>
                                                          <label><input checked type="radio" name="covershow" value="1"> 显示</label>
                                                          <label class="j-ml8"><input type="radio" name="covershow" value="0"> 不显示</label>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">投票说明</td>
                                                        <td>
                                                          <textarea rows="5" class="j-noresize j-w80" name="describes">{$detail.describes}</textarea>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">时间设置</td>
                                                        <td>
                                                          <input id="time1" type="text" name="start" value="{$detail.start|date='Y/m/d H:i',###}" datatype="Require" msg="请设置开始时间"> —
                                                          <input id="time2" type="text" name="end" value="{$detail.end|date='Y/m/d H:i',###}" datatype="Require" msg="请设置结束时间">
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="input-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">最多可选</td>
                                                        <td>
                                                          <input type="number" name="optselect" value="{$detail.optselect|default='1'}" datatype="Number" msg="请正确输入可选项数量">
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">投票结果</td>
                                                        <td>
                                                          <label><input checked type="radio" name="resultshow" value="0"> 投票前可见</label>
                                                          <label class="j-ml8"><input type="radio" name="resultshow" value="1"> 投票后可见</label>
                                                          <label class="j-ml8"><input type="radio" name="resultshow" value="2"> 投票结束可见</label>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                            
                                            <tr>
                                              <td>
                                                <!--start-input:text-->
                                                <div class="textarea-group">
                                                  <table width="100%" class="j-table-noborder" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                      <tr>
                                                        <td class="j-w-80 j-input-lalel">选项</td>
                                                        <td>
                                                          <table class="table table-striped table-bordered">
                                                            <tbody id="optionsnode">
                                                              <tr>
                                                                <td>文字描述</td>
                                                                <td width="180">添加图片</td>
                                                                <td width="60"></td>
                                                              </tr>
                                                              <!-- loop -->
                                                              <empty name="optlist">
                                                              <tr>
                                                                <td><input class="j-w90" type="text" placeholder="请输入文字描述" name="option_titles[]" datatype="Require" msg="请输入文字描述"></td>
                                                                <td>
                                                                  <input type="hidden" name="filepath[]" value="">
                                                                  <img class="j-w-50" src="/Public/images/moren.jpg">
                                                                  <a class="btn add-optionimgfile">上传图片</a>
                                                                </td>
                                                                <td><a class="btn btn-info" onclick="deleteoption(this)">删除</a></td>
                                                              </tr>
                                                              <else/>
                                                              <volist name="optlist" id="optitem">
                                                              <tr>
                                                                <td><input class="j-w90" type="text" value="{$optitem.title}" placeholder="请输入文字描述" name="option_titles[]" datatype="Require" msg="请输入文字描述"><input type="hidden" name="oldid[]" value="{$optitem.id}" /></td>
                                                                <td>
                                                                  <input type="hidden" name="filepath[]" value="{$optitem.picurl|default=''}">
                                                                  <img class="j-w-50" src="{$optitem.picurl|default='/Public/images/moren.jpg'}">
                                                                  <a class="btn add-optionimgfile">上传图片</a>
                                                                </td>
                                                                <td><a class="btn btn-info" onclick="deleteoption(this)">删除</a></td>
                                                              </tr>
                                                              </volist>
                                                              </empty>
                                                              <!-- loop -->
                                                            </tbody>
                                                          </table>
                                                          
                                                          <div class="j-txtct"><a class="btn" id="addoption"><span class="icon-plus"></span> 添加选项</a></div>
                                                        </td>
                                                      </tr>
                                                    </tbody>
                                                  </table>
                                                </div>
                                                <!--end-input:text-->
                                              </td>
                                            </tr>
                                          </tbody>
                                        </table>
                                            
                                      </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                    </div>
					
					<div class="j-m j-h1 j-bkcl2"></div>
					<div class="j-m j-h20"></div>
					
					<div class="j-m">
						<input type="submit" class="j-button-red j-pct" value="保存">
					</div>
					<div class="j-m j-h20"></div>
					</form>
          <!--表单-->
          </div>
          <!--模块结束-->
                
                <div class="j-m j-h20"></div>
                <include file="Public:footer" />
                <div class="j-m j-h20"></div>
            </div>
        </div>
      </div>
    </div>
</div>
<!--内容-->
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!--js-->
<script src="/static/js/jquery.js"></script>
<script src="/static/plugin/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/plugin/datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="/static/plugin/datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="/static/weixin/js/site.js"></script>
<script src="/static/weixin/js/upload.js"></script>
<script src="/static/js/validator.js"></script>

<script src="/static/plugin/kindeditor/kindeditor-all-min.js"></script>

<script>
KindEditor.ready(function(K) {
  var editor = K.editor({
    allowFileManager : true
  });
  $('#uploadcover').click(function() {
    var e=$(this);
    editor.loadPlugin('image', function() {
      editor.plugin.imageDialog({
        showRemote : false,
        imageUrl : $(e).parent().find("input").val(),
        clickFn : function(url, title, width, height, border, align) {
          $(e).parent().find("input").val(url);
          $(e).parent().find("img").prop("src",url);
          editor.hideDialog();
        }
      });
    });
  });
  
  //选项内选择图片
  $(".add-optionimgfile").live("click",function(e){
    editor.loadPlugin('image', function() {
      editor.plugin.imageDialog({
        showRemote : false,
        imageUrl : $(e.target).parent().find("input").val(),
        clickFn : function(url, title, width, height, border, align) {
          $(e.target).parent().find("input[name='filepath[]']").val(url);
          $(e.target).parent().find("img").prop("src",url);
          editor.hideDialog();
        }
      });
    });
  });
});

//删除选项
function deleteoption(a){
  $(a).parent().parent().remove();
}

$(this).ready(function(e) {
  //时间选择器
	$("#time1").datetimepicker({
    format: 'yyyy/mm/dd hh:ii',
		language:  'zh-CN',
	});
	
	$("#time2").datetimepicker({
    format: 'yyyy/mm/dd hh:ii',
		language:  'zh-CN',
	});
  
  //添加选项
  $("#addoption").on("click",function(){
    var html='<tr><td><input class="j-w90" type="text" placeholder="请输入文字描述" name="option_titles[]" datatype="Require" msg="请输入文字描述"></td><td><input type="hidden" name="filepath[]" value=""><img class="j-w-50" src="/Public/images/moren.jpg"><a class="btn add-optionimgfile">添加图片</a></td><td><a class="btn btn-info" onclick="deleteoption(this)">删除</a></td></tr>';
    $("#optionsnode").append(html);
  });
  
  
  //初始化是否显示封面
  $("input:radio[name='covershow'][value='{$detail.covershow}']").prop("checked",true);
  $("input:radio[name='resultshow'][value='{$detail.resultshow}']").prop("checked",true);
});
</script>
</body>
</html>